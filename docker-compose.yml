# Docker compose debe correr en la carpeta principal del usuario principal
# QUITAR PREBUILD UNA VEZ QUE YA CORRIO POR PRIMERA VEZ EL DOCKER-COMPOSE 

services:
  # PREBUILD
  prebuild:
    image: alpine:edge
    volumes:
      - ./nginx:/mnt/nginx
    command: /bin/sh -c "touch /mnt/nginx/nginx.conf && echo 'events { worker_connections  1024; } http { server_tokens off; charset utf-8; server { listen 80 default_server; server_name _; location / { proxy_pass http://node:3000; } } }' > /mnt/nginx/nginx.conf"

  # NODE
  node:
    image: sen00/node-nginx-ssl:node
    restart: unless-stopped
    container_name: node
    user: "node"
    environment:
      - NODE_ENV=production

  # NGINX
  nginx:
    container_name: nginx
    restart: unless-stopped
    image: nginx:stable-perl
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./nginx:/etc/nginx
